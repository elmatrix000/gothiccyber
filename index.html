<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GothAlienBoy — Signal Run</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #020908;
  color: #7fffe6;
  font-family: monospace;
  overflow: hidden;
}

#game {
  width: 100vw;
  height: 100vh;
}

canvas {
  width: 100% !important;
  height: 100% !important;
  touch-action: none;
}
</style>
</head>

<body>
<div id="game"></div>

<script>
/* ================= CONFIG ================= */

const W = 360;
const H = 640;

const config = {
  type: Phaser.AUTO,
  parent: "game",
  width: W,
  height: H,
  scale: {
    mode: Phaser.Scale.FIT,
    autoCenter: Phaser.Scale.CENTER_BOTH
  },
  physics: {
    default: "arcade",
    arcade: { gravity: { y: 0 } }
  },
  scene: { create, update }
};

new Phaser.Game(config);

/* ================= STATE ================= */

let player, enemies, bullets, enemyBullets, particles;
let move = 0;
let canShoot = true;
let score = 0;
let wave = 1;
let shake = 0;
let gameOver = false;

/* ================= CREATE ================= */

function create() {
  // Background pulse
  this.bg = this.add.rectangle(0, 0, W, H, 0x041917).setOrigin(0);

  // Grid
  this.grid = this.add.graphics();

  // Player
  player = this.add.rectangle(W / 2, H - 90, 28, 28, 0x00ffd0);
  this.physics.add.existing(player);
  player.body.setCollideWorldBounds(true);

  bullets = this.physics.add.group();
  enemyBullets = this.physics.add.group();
  enemies = this.physics.add.group();

  spawnWave(this);

  this.physics.add.overlap(bullets, enemies, hitEnemy, null, this);
  this.physics.add.overlap(enemyBullets, player, hitPlayer, null, this);

  ui(this);
}

/* ================= UPDATE ================= */

function update(time) {
  if (gameOver) return;

  // Pulse background
  this.bg.fillColor = Phaser.Display.Color.GetColor(
    5,
    20 + Math.sin(time * 0.004) * 10,
    18
  );

  drawGrid(this, time);

  player.body.setVelocityX(move * 220);

  enemies.children.each(e => {
    if (!e) return;
    e.y += e.speed;
    e.x += Math.sin(time * 0.002 + e.phase) * 0.8;

    if (Phaser.Math.Between(0, 200) === 1) {
      fireEnemyBullet(this, e);
    }
  });

  bullets.children.each(b => b && b.y < -20 && b.destroy());
  enemyBullets.children.each(b => b && b.y > H + 20 && b.destroy());
}

/* ================= VISUALS ================= */

function drawGrid(scene, time) {
  scene.grid.clear();
  scene.grid.lineStyle(1, 0x04433e, 0.4);
  for (let y = 0; y < H; y += 40) {
    scene.grid.lineBetween(
      0,
      y + (time * 0.02) % 40,
      W,
      y + (time * 0.02) % 40
    );
  }
}

/* ================= GAMEPLAY ================= */

function spawnWave(scene) {
  for (let i = 0; i < 4 + wave; i++) {
    const e = scene.add.rectangle(
      Phaser.Math.Between(30, W - 30),
      Phaser.Math.Between(-200, -40),
      22,
      22,
      0xff3355
    );
    scene.physics.add.existing(e);
    e.speed = 0.6 + wave * 0.15;
    e.phase = Math.random() * 6;
    enemies.add(e);
  }
}

function shoot(scene) {
  if (!canShoot || gameOver) return;

  const b = scene.add.rectangle(player.x, player.y - 20, 4, 14, 0x00ffff);
  scene.physics.add.existing(b);
  b.body.setVelocityY(-460);
  bullets.add(b);

  canShoot = false;
  scene.time.delayedCall(180, () => canShoot = true);
}

function fireEnemyBullet(scene, enemy) {
  const b = scene.add.rectangle(enemy.x, enemy.y + 14, 4, 10, 0xff8800);
  scene.physics.add.existing(b);
  b.body.setVelocityY(220);
  enemyBullets.add(b);
}

function hitEnemy(bullet, enemy) {
  bullet.destroy();
  enemy.destroy();
  score += 10;

  if (enemies.countActive(true) === 0) {
    wave++;
    spawnWave(this);
    shake = 10;
  }
}

function hitPlayer() {
  end(this);
}

/* ================= UI ================= */

function ui(scene) {
  scene.scoreText = scene.add.text(10, 10, "SIGNAL: 0", { fontSize: "14px" });

  const style = {
    fontSize: "24px",
    backgroundColor: "#111",
    color: "#00ffd0",
    padding: { x: 14, y: 6 }
  };

  const left = scene.add.text(20, H - 60, "◀", style).setInteractive();
  const right = scene.add.text(80, H - 60, "▶", style).setInteractive();
  const fire = scene.add.text(W - 70, H - 60, "⦿", style).setInteractive();

  left.on("pointerdown", () => move = -1);
  left.on("pointerup", () => move = 0);
  left.on("pointerout", () => move = 0);

  right.on("pointerdown", () => move = 1);
  right.on("pointerup", () => move = 0);
  right.on("pointerout", () => move = 0);

  fire.on("pointerdown", () => shoot(scene));

  scene.events.on("update", () => {
    scene.scoreText.setText("SIGNAL: " + score);
  });
}

/* ================= END ================= */

function end(scene) {
  gameOver = true;
  scene.add.rectangle(0, 0, W, H, 0x000000, 0.85).setOrigin(0);
  scene.add.text(
    W / 2,
    H / 2,
    "SIGNAL LOST\nTHE GRID RECLAIMS YOU",
    { fontSize: "18px", color: "#ff3355", align: "center" }
  ).setOrigin(0.5);
}
</script>
</body>
</html>
